function addProgressItemRow(){var e=$('<tr class="progressItem"><td><textarea name="name" class="input-progress-item-name form-control" required></textarea></td><td style="vertical-align: middle;"><input type="text" name="amount" class="input-progress-item-value form-control" required data-parsley-type="number"/></td><td style="width:150px;text-align:center;vertical-align:middle"><a href="javascript:void(0)" class="add-progress-item-row" onclick="addProgressItemRow();"><i class="fa fa-plus"></i> Add</a> / <a href="javascript:void(0)" class="delete-progress-item-row" onclick="deleteProgressItemRow(this);"><i class="fa fa-minus"></i> Delete</a></td></tr>');$("#progressItems").append(e)}function deleteProgressItemRow(e){$(e).closest("tr").remove()}var metaData=$("#project-data").data(),deleteProjectUrl=metaData.deleteProjectUrl,editProjectUrl=metaData.editProjectUrl,getProjectProgressItemsUrl=metaData.getProjectProgressItemsUrl,newProgressItemUrl=metaData.newProgressItemUrl,projectActive=metaData.projectActive,projectAdminFee=metaData.projectAdminFee,projectId=metaData.projectId,projectMargin=metaData.projectMargin,projectName=metaData.projectName;$.ajax({url:getProjectProgressItemsUrl,type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){console.log(e),$("#table").bootstrapTable({columns:[{checkbox:!0},{field:"name",title:"Name",halign:"center",editable:{type:"text"},sortable:!0},{field:"contract_value",title:"Contract Value",halign:"center",editable:{type:"text"},sortable:!0},{field:"completed_value",title:"Completed Value",halign:"center",editable:{type:"text"},sortable:!0},{field:"percentage",title:"Percentage",halign:"center",sortable:!0}],data:e.progress_items,rowStyle:"rowStyle",toolbar:"#toolbar"})}),$.fn.editable.defaults.mode="inline",$("#btn-add-new-progress-items").on("click",function(){console.log("here");var e=$("#new-progress-items-form").parsley();e.validate(),console.log(e.isValid()),e.isValid()&&swal({title:"Are you sure to delete selected rows?",text:"You cannot recover them later!",type:"warning",showCancelButton:!0,confirmButtonColor:"teal",confirmButtonText:"Yes, save them!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1,customClass:"deleteRowsConfirmation"},function(e){return e?($(".progressItem").each(function(e,t){var a=$(t).find("textarea").val(),o=accounting.parse($(t).find("input").val());$.ajax({url:newProgressItemUrl,type:"POST",data:JSON.stringify({name:a,contract_value:o,project_id:projectId}),contentType:"application/json; charset=utf-8",dataType:"json"})}),void swal({title:"Nice!",text:"You saved all changes",type:"success"},function(){location.reload()})):void swal("Cancelled","Your project is safe :)","error")})});var $table=$("#table");$table.on("editable-save.bs.table",function(e){$("#btn-save").prop("disabled",!1)}),$table.on("check.bs.table check-all.bs.table check-some.bs.table",function(e){$("#btn-delete").prop("disabled",!1)}),$table.on("uncheck-all.bs.table",function(e){$("#btn-delete").prop("disabled",!0)}),$table.on("uncheck.bs.table	uncheck-some.bs.table",function(e){var t=$table.bootstrapTable("getSelections");0===t&&$("#btn-delete").prop("disabled",!0)}),$("#btn-delete").on("click",function(e){swal({title:"Are you sure to delete selected rows?",text:"You cannot recover them later!",type:"warning",showCancelButton:!0,confirmButtonColor:"teal",confirmButtonText:"Yes, save them!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1,customClass:"deleteRowsConfirmation"},function(e){if(!e)return void swal("Cancelled","Your project is safe :)","error");for(var t=!0,a=$table.bootstrapTable("getSelections"),o=0;o<a.length;++o)$.ajax({url:"/api/v1.0/progress_items/"+a[o].id,type:"DELETE",contentType:"application/json; charset=utf-8",dataType:"json"}).fail(function(){t=!1});t&&swal({title:"Nice!",text:"Delete variations",type:"success"},function(){location.reload()})})}),$("#btn-save").on("click",function(e){swal({title:"Are you sure to save all the changes?",type:"info",showCancelButton:!0,confirmButtonColor:"teal",confirmButtonText:"Yes, save them!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1,customClass:"saveVariationsConfirmation"},function(e){if(!e)return void swal("Cancelled","Your saves are unsaved","error");for(var t=$table.bootstrapTable("getData"),a=0;a<t.length;++a){var o=t[a],l=o.id,r=o.name,n=o.contract_value,s=o.completed_value;$.ajax({url:"/api/v1.0/progress_items/"+l,type:"PUT",data:JSON.stringify({name:r,contract_value:n,completed_value:s}),contentType:"application/json; charset=utf-8",dataType:"json"})}swal({title:"Nice!",text:"You saved all changes.",type:"success"},function(){location.reload()})})});