function addProgressItemRow(){var e=$('<tr class="progressItem"><td><textarea name="name" class="input-progress-item-name form-control" required></textarea></td><td style="vertical-align: middle;"><input type="text" name="amount" class="input-progress-item-value form-control" required data-parsley-type="number"/></td><td style="width:150px;text-align:center;vertical-align:middle"><a href="javascript:void(0)" class="add-progress-item-row" onclick="addProgressItemRow();"><i class="fa fa-plus"></i> Add</a> / <a href="javascript:void(0)" class="delete-progress-item-row" onclick="deleteProgressItemRow(this);"><i class="fa fa-minus"></i> Delete</a></td></tr>');$("#progressItems").append(e)}function deleteProgressItemRow(e){$(e).closest("tr").remove()}var metaData=$("#project-data").data(),deleteProjectUrl=metaData.deleteProjectUrl,editProjectUrl=metaData.editProjectUrl,getProjectProgressItemsUrl=metaData.getProjectProgressItemsUrl,newProgressItemUrl=metaData.newProgressItemUrl,projectActive=metaData.projectActive,projectAdminFee=metaData.projectAdminFee,projectId=metaData.projectId,projectMargin=metaData.projectMargin,projectName=metaData.projectName;$.ajax({url:getProjectProgressItemsUrl,type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){console.log(e),$("#table").bootstrapTable({columns:[{checkbox:!0},{field:"name",title:"Name",halign:"center",editable:{type:"text"},sortable:!0},{field:"contract_value",title:"Contract Value",halign:"center",editable:{type:"text"},sortable:!0},{field:"completed_value",title:"Completed Value",halign:"center",editable:{type:"text"},sortable:!0},{field:"percentage",title:"Percentage",halign:"center",sortable:!0}],data:e.progress_items,rowStyle:"rowStyle",toolbar:"#toolbar"})}),$.fn.editable.defaults.mode="inline",$(document).on("ready",function(){$("#btn-add-new-progress-items").on("click",function(){var e=$("#new-progress-items-form").parsley();e.validate(),e.isValid()&&swal({title:"Are you sure to delete selected rows?",text:"You cannot recover them later!",type:"warning",showCancelButton:!0,confirmButtonColor:"teal",confirmButtonText:"Yes, save them!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1,customClass:"deleteRowsConfirmation"},function(e){return e?($(".progressItem").each(function(e,t){var a=$(t).find("textarea").val(),o=accounting.parse($(t).find("input").val());$.ajax({url:newProgressItemUrl,type:"POST",data:JSON.stringify({name:a,contract_value:o,project_id:projectId}),contentType:"application/json; charset=utf-8",dataType:"json"})}),void swal({title:"Nice!",text:"You saved all changes",type:"success"},function(){location.reload()})):void swal("Cancelled","Your project is safe :)","error")})});var e=$("#table");e.on("editable-save.bs.table",function(e){$("#btn-save").prop("disabled",!1)}),e.on("check.bs.table check-all.bs.table check-some.bs.table",function(e){$("#btn-delete").prop("disabled",!1)}),e.on("uncheck-all.bs.table",function(e){$("#btn-delete").prop("disabled",!0)}),e.on("uncheck.bs.table	uncheck-some.bs.table",function(t){var a=e.bootstrapTable("getSelections");0==a&&$("#btn-delete").prop("disabled",!0)}),$("#btn-delete").on("click",function(t){swal({title:"Are you sure to delete selected rows?",text:"You cannot recover them later!",type:"warning",showCancelButton:!0,confirmButtonColor:"teal",confirmButtonText:"Yes, save them!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1,customClass:"deleteRowsConfirmation"},function(t){if(!t)return void swal("Cancelled","Your project is safe :)","error");for(var a=!0,o=e.bootstrapTable("getSelections"),r=0;r<o.length;++r)$.ajax({url:"/api/v1.0/progress_items/"+o[r].id,type:"DELETE",contentType:"application/json; charset=utf-8",dataType:"json"}).fail(function(){a=!1});a&&swal({title:"Nice!",text:"Delete variations",type:"success"},function(){location.reload()})})}),$("#btn-save").on("click",function(t){swal({title:"Are you sure to save all the changes?",type:"info",showCancelButton:!0,confirmButtonColor:"teal",confirmButtonText:"Yes, save them!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1,customClass:"saveVariationsConfirmation"},function(t){if(!t)return void swal("Cancelled","Your saves are unsaved","error");for(var a=e.bootstrapTable("getData"),o=0;o<a.length;++o){var r=a[o],n=r.id,l=r.name,s=r.contract_value,c=r.completed_value;$.ajax({url:"/api/v1.0/progress_items/"+n,type:"PUT",data:JSON.stringify({name:l,contract_value:s,completed_value:c}),contentType:"application/json; charset=utf-8",dataType:"json"})}swal({title:"Nice!",text:"You saved all changes.",type:"success"},function(){location.reload()})})})});