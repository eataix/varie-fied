function onSelectChanged(e){"use strict";var t=$("#select_project_id")[0].selectize.items[0];$.ajax({url:"/api/v1.0/projects/"+t,type:"GET",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(e){$("#margin").val(100*e.margin+"%");var t=$("#admin-fee");null===e.admin_fee?(t.parents(".form-group").hide(),t.val("")):(t.parents(".form-group").show(),t.val(accounting.formatMoney(e.admin_fee))),update()}).fail(function(){})}function isNumeric(e){"use strict";return $.isNumeric(e)}function update(){"use strict";var e=0;$(".input-amount").each(function(t,a){var n=$(a).val();""!==n&&isNumeric(n)&&(e+=parseFloat(n))}),$("#value-of-work").val(accounting.formatMoney(e));var t=0;t+=e*(1+parseFloat($("#margin").val())/100);var a=$("#admin-fee").val();""!==a&&(t+=accounting.parse(a)),$("#subtotal").val(accounting.formatMoney(t))}function addRow(){"use strict";var e=$('<tr class="variationItem"><td><textarea name="description" class="input-desc form-control" required></textarea></td><td style="vertical-align:middle;"><input type="text" name="amount" class="input-amount form-control" required data-parsley-type="number" oninput="update()"/></td><td style="width:150px;text-align:center;vertical-align:middle;"><a href="javascript:void(0)" class="add-row" onclick="addRow();"><i class="fa fa-plus"></i> Add</a> / <a href="javascript:void(0)" class="delete-row" onclick="deleteRow(this);"><i class="fa fa-minus"></i> Delete</a></td></tr>');$("#items").append(e);var t=$("#descriptionDiv");t.show(),t.val(""),t.attr("required","")}function deleteRow(e){"use strict";$(e).closest("tr").remove(),update();var t=$(".variationItem");if(1===t.length){var a=$("#descriptionDiv");a.hide(),a.val(t.find("textarea").val()),a.find("textarea").removeAttr("required")}}function addClientRow(){"use strict";var e=$('<tr class="client"><td><textarea name="clientName" class="input-desc form-control" required></textarea></td><td style="vertical-align: middle;"><input type="text" name="firstAddressLine" class="input-amount form-control" required/></td><td style="vertical-align: middle;"><input type="text" name="secondAddressLine" class="input-amount form-control" required/></td><td style="width:80px;text-align:center;vertical-align:middle;"><a href="javascript:void(0)" class="add-row" onclick="addClientRow();"><i class="fa fa-plus"></i></a> / <a href="javascript:void(0)" class="delete-row" onclick="deleteClientRow(this);"><i class="fa fa-minus"></i></a></td></tr>');$("#clients").append(e)}function deleteClientRow(e){"use strict";$(e).closest("tr").remove()}function isNull(e){"use strict";return null===e}function isTrue(e){"use strict";return e===!0}function isFalse(e){"use strict";return e===!1}var metaData=$("#meta-data").data(),newProjectUrl=metaData.newProjectUrl,newVariationUrl=metaData.newVariationUrl,newItemUrl=metaData.newItemUrl,newClientUrl=metaData.newClientUrl;!function(){"use strict";$.material.init(),$("#picker_datetime").datetimepicker({showTodayButton:!0}),$("#form-new-project").parsley(),$("#form-new-variation").parsley(),$("#select_project_id").selectize({sortField:"text"})}(),$("#btn-add-project").on("click",function(){"use strict";var e=$("#form-new-project").parsley();if(e.validate(),e.isValid()){var t=$("#extra_project_name").val(),a=$("#extra_margin").val(),n=$("#extra_reference_number").val(),i=$("#extra_admin_fee").val();""===i&&(i=null),swal({title:"Are you sure to add a project?",text:"You can recover this project later!",type:"info",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, add it!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1,customClass:"newProjectConfirmation"},function(e){if(!e)return void swal("Cancelled","The project is not added :)","error");var r=$(".newProjectConfirmation").find(".confirm"),o=r.html();r.html('<i class="fa fa-spinner fa-spin"></i> '+o),r.off("click"),$.ajax({url:newProjectUrl,type:"POST",data:JSON.stringify({name:t,margin:a,reference_number:n,admin_fee:i}),contentType:"application/json; charset=utf-8",dataType:"json"}).fail(function(){}).done(function(e){for(var t=$(".client"),a=new Array(t.length),n=0;n<a.length;n+=1)a[n]=null;!function n(i){if(!(i>=t.length)){var r=t[i],o=$(r.children[0].children[0]).val(),l=$(r.children[1].children[0]).val();""===l&&(l=null);var c=$(r.children[2].children[0]).val();""===c&&(c=null),$.ajax({url:newClientUrl,type:"POST",data:JSON.stringify({name:o,first_line_address:l,second_line_address:c,project_id:e.id}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){a[i]=!0,n(i+1)}).fail(function(){a[i]=!1})}}(0),function t(){a.some(isFalse)?console.error("failed to save some changes"):a.some(isNull)?setTimeout(t,100):a.every(isTrue)&&swal({title:"Nice!",text:"You created a new project: "+e.name,type:"success"},function(){location.reload()})}()})})}}),$("#btn_submit").on("click",function(){"use strict";var e=$("#form-new-variation").parsley();if(e.validate(),e.isValid()){var t=$("#select_project_id")[0].selectize.items[0],a=$("#picker_datetime").data("DateTimePicker").date(),n=a.utc().format(),i=$("#input_subcontractor").val(),r=$("#input_invoice_no").val(),o=accounting.unformat($("#subtotal").val()),l="",c=$(".variationItem");l=1===c.length?c.find("textarea").val():$("#input_description").val(),swal({title:"Are you sure?",text:"Time: "+a.format("Do MMMM YYYY h:mm:ss a")+"\nSubcontractor: "+i+"\nAmount: "+accounting.formatMoney(o),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, add it!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1,customClass:"newVariationConfirmation"},function(e){if(!e)return void swal("Cancelled","Your imaginary file is safe :)","error");var a=$(".newVariationConfirmation").find(".confirm"),c=a.html();a.html('<i class="fa fa-spinner fa-spin"></i> '+c),a.off("click"),$.ajax({url:newVariationUrl,type:"POST",data:JSON.stringify({project_id:t,date:n,subcontractor:i,invoice_no:r,amount:o,description:l}),contentType:"application/json; charset=utf-8",dataType:"json"}).fail(function(){}).done(function(e){for(var t=e.vid,a=$(".variationItem"),n=new Array(a.length),i=0;i<n.length;i+=1)n[i]=null;!function e(i){if(!(i>=a.length)){var r=a[i],o=$(r.children[0].children[0]).val(),l=$(r.children[1].children[0]).val();$.ajax({url:newItemUrl,type:"POST",data:JSON.stringify({variation_id:t,description:o,amount:l}),contentType:"application/json; charset=utf-8",dataType:"json"}).success(function(){n[i]=!0,e(i+1)}).fail(function(){n[i]=!1})}}(0),function e(){n.some(isFalse)||(n.some(isNull)?setTimeout(e,100):n.every(isTrue)&&swal({title:"Nice!",text:"You created a new variation",type:"success"},function(){location.reload()}))}()})})}}),$(".input-amount").on("change",update);
//# sourceMappingURL=main.min.map