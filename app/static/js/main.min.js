function onSelectChanged(){"use strict";var a=$("#select_project_id")[0].selectize.items[0];$.ajax({url:"/api/v1.0/projects/"+a,type:"GET",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(a){$("#margin").val(100*a.margin+"%");var b=$("#admin-fee");null===a.admin_fee?(b.parents(".form-group").hide(),b.val("")):(b.parents(".form-group").show(),b.val(accounting.formatMoney(a.admin_fee))),update()}).fail(function(){})}function update(){"use strict";var a=0;$(".input-amount").each(function(b,c){var d=$(c).val();""!==d&&$.isNumeric(d)&&(a+=parseFloat(d))}),$("#value-of-work").val(accounting.formatMoney(a));var b=a*(1+parseFloat($("#margin").val())/100),c=$("#admin-fee").val();""!==c&&(b+=accounting.parse(c)),$("#subtotal").val(accounting.formatMoney(b))}function addRow(){"use strict";var a=$('<tr class="variationItem"><td><textarea name="description" class="input-desc form-control" required></textarea></td><td style="vertical-align:middle;"><input type="text" name="amount" class="input-amount form-control" required data-parsley-type="number" oninput="update()"/></td><td style="width:150px;text-align:center;vertical-align:middle;"><a href="javascript:void(0)" class="add-row" onclick="addRow();"><i class="fa fa-plus"></i> Add</a> / <a href="javascript:void(0)" class="delete-row" onclick="deleteRow(this);"><i class="fa fa-minus"></i> Delete</a></td></tr>');$("#items").append(a);var b=$("#descriptionDiv");b.show(),b.val(""),b.attr("required","")}function deleteRow(a){"use strict";$(a).closest("tr").remove(),update();var b=$(".variationItem");if(1===b.length){var c=$("#descriptionDiv");c.hide(),c.find("textarea").removeAttr("required")}}function addClientRow(){"use strict";var a=$('<tr class="client"><td><textarea name="clientName" class="input-client-name form-control" required></textarea></td><td style="vertical-align: middle;"><input type="text" name="firstAddressLine" class="input-first-address form-control" required/></td><td style="vertical-align: middle;"><input type="text" name="secondAddressLine" class="input-second-address form-control" required/></td><td style="width:80px;text-align:center;vertical-align:middle;"><a href="javascript:void(0)" class="add-row" onclick="addClientRow();"><i class="fa fa-plus"></i></a> / <a href="javascript:void(0)" class="delete-row" onclick="deleteClientRow(this);"><i class="fa fa-minus"></i></a></td></tr>');$("#clients").append(a)}function deleteClientRow(a){"use strict";$(a).closest("tr").remove()}function isNull(a){"use strict";return null===a}function isTrue(a){"use strict";return a===!0}function isFalse(a){"use strict";return a===!1}var metaData=$("#meta-data").data(),newProjectUrl=metaData.newProjectUrl,newVariationUrl=metaData.newVariationUrl,newItemUrl=metaData.newItemUrl,newClientUrl=metaData.newClientUrl,newProgressItemUrl=metaData.newProgressItemUrl;$(document).on("ready",function(){"use strict";$.material.init(),$("#picker_datetime").datetimepicker({showTodayButton:!0}),$("#select_project_id").selectize({sortField:"text"})}),$("#btn-add-project").on("click",function(){"use strict";var a=$("#form-new-project").parsley();if(a.validate(),a.isValid()){var b=$("#extra_project_name").val(),c=$("#extra_margin").val(),d=$("#extra_reference_number").val(),e=$("#extra_admin_fee").val();""===e&&(e=null),swal({title:"Are you sure to add a project?",text:"You can delete this project later if necessary!",type:"info",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, add it!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1,customClass:"newProjectConfirmation"},function(a){if(!a)return void swal("Cancelled","The project is not yet added :)","error");var f=$(".newProjectConfirmation").find(".confirm"),g=f.html();f.html('<i class="fa fa-spinner fa-spin"></i> '+g),$.ajax({url:newProjectUrl,type:"POST",data:JSON.stringify({name:b,margin:c,reference_number:d,admin_fee:e}),contentType:"application/json; charset=utf-8",dataType:"json"}).fail(function(){}).done(function(a){var b=$(".client"),c=new Array(b.length);_.fill(c,null),function d(e){if(!(e>=b.length)){var f=$(b[e]),g=f.find(".input-client-name").val(),h=f.find(".input-first-address").val();""===h&&(h=null);var i=f.find(".input-second-address").val();""===i&&(i=null),console.log(b),console.log(f),console.log(g),console.log(h),console.log(i),console.log(a.id),$.ajax({url:newClientUrl,type:"POST",data:JSON.stringify({name:g,first_line_address:h,second_line_address:i,project_id:a.id}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){c[e]=!0,d(e+1)}).fail(function(){c[e]=!1})}}(0),function b(){console.log(c),c.some(isFalse)?console.error("failed to save some changes"):c.some(isNull)?setTimeout(b,100):c.every(isTrue)&&swal({title:"Nice!",text:"You created a new project: "+a.name,type:"success"},function(){location.reload()})}()})})}}),$("#btn_submit").on("click",function(){"use strict";var a=$("#form-new-variation").parsley();if(a.validate(),a.isValid()){var b=$("#select_project_id")[0].selectize.items[0],c=$("#picker_datetime").data("DateTimePicker").date(),d=c.utc().format(),e=$("#input_subcontractor").val(),f=$("#input_invoice_no").val(),g=accounting.unformat($("#subtotal").val()),h="",i=$(".variationItem");h=1===i.length?i.find("textarea").val():$("#input_description").val(),swal({title:"Are you sure to add a variation?",text:"Time: "+c.format("Do MMMM YYYY h:mm:ss a")+"\nSubcontractor: "+e+"\nSubtotal: "+accounting.formatMoney(g),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, add it!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1,customClass:"newVariationConfirmation"},function(a){if(!a)return void swal("Cancelled","The variation is not yet added :)","error");var c=$(".newVariationConfirmation").find(".confirm"),i=c.html();c.html('<i class="fa fa-spinner fa-spin"></i> '+i),$.ajax({url:newVariationUrl,type:"POST",data:JSON.stringify({project_id:b,date:d,subcontractor:e,invoice_no:f,amount:g,description:h}),contentType:"application/json; charset=utf-8",dataType:"json"}).fail(function(){}).done(function(a){var b=a.vid,c=$(".variationItem"),d=new Array(c.length);_.fill(d,null),function a(e){if(!(e>=c.length)){var f=$(c[e]),g=f.find(".input-desc").val(),h=f.find(".input-amount").val();$.ajax({url:newItemUrl,type:"POST",data:JSON.stringify({variation_id:b,description:g,amount:h}),contentType:"application/json; charset=utf-8",dataType:"json"}).success(function(){d[e]=!0,a(e+1)}).fail(function(){d[e]=!1})}}(0),function a(){d.some(isFalse)?console.log("error"):d.some(isNull)?setTimeout(a,100):d.every(isTrue)&&swal({title:"Nice!",text:"You created a new variation",type:"success"},function(){location.reload()})}()})})}}),$(".input-amount").on("change",update);
//# sourceMappingURL=main.min.js.map