function pendingClick(a){"use strict";var b=$(a).parents("tr");b.attr("class","info"),b.find(".checkbox-approved").prop("checked",!1),b.find(".checkbox-declined").prop("checked",!1),$("#btn-save").prop("disabled",!1)}function pendingFormatter(a,b,c){"use strict";var d;return d=a?'<input class="checkbox checkbox-pending" type="checkbox" checked="" onclick="pendingClick(this);">':'<input class="checkbox checkbox-pending" type="checkbox" onclick="pendingClick(this);">',"<label>"+d+"</label>"}function approvedClick(a){"use strict";var b=$(a).parents("tr");b.attr("class","success"),b.find(".checkbox-pending").prop("checked",!1),b.find(".checkbox-declined").prop("checked",!1),$("#btn-save").prop("disabled",!1)}function approvedFormatter(a,b,c){"use strict";var d;return d=a?'<input class="checkbox checkbox-approved" type="checkbox" checked="" onclick="approvedClick(this);">':'<input class="checkbox checkbox-approved" type="checkbox" onclick="approvedClick(this);">',"<label>"+d+"</label>"}function declinedClick(a){"use strict";var b=$(a).parents("tr");b.attr("class","danger"),b.find(".checkbox-pending").prop("checked",!1),b.find(".checkbox-approved").prop("checked",!1),$("#btn-save").prop("disabled",!1)}function declinedFormatter(a,b,c){"use strict";var d;return d=a?'<input class="checkbox checkbox-declined" type="checkbox" checked="" onclick="declinedClick(this);">':'<input class="checkbox checkbox-declined" type="checkbox" onclick="declinedClick(this);">',"<label>"+d+"</label>"}function completeClick(){"use strict";$("#btn-save").prop("disabled",!1)}function completeFormatter(a,b,c){"use strict";var d;return d=a?'<input class="checkbox checkbox-complete" type="checkbox" checked="" onclick="completeClick();">':'<input class="checkbox checkbox-complete" type="checkbox" onclick="completeClick();">',"<label>"+d+"</label>"}function rowStyle(a,b){"use strict";return a.pending?{classes:"info"}:a.approved?{classes:"success"}:a.declined?{classes:"danger"}:{classes:"active"}}function timeFormatter(a,b,c){"use strict";return"<p>"+moment(a).toDate()+"</p>"}function moneyFormatter(a,b,c){"use strict";return accounting.formatMoney(a)}function validate_required(a){"use strict";return null===a||""===a?"Cannot be empty!":void 0}function detailFormatter(a,b){"use strict";var c="/api/v1.0/variations/"+b.vid+"/items/";return $.ajax({url:c,type:"GET",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(b){for(var c=b.items,d='<table class="table table-hover"><thead><tr><th style="text-align: center">Name</th><th style="text-align: center">Amount</th></tr></thead><tbody>',e="new-editable-description-"+a,f="new-editable-amount-"+a,g=0;g<c.length;g+=1){var h=c[g],i=h.id,j='<a href="javascript:void(0)" data-type="textarea" pk='+i+' class="'+e+'">'+h.description+"</a>",k='<a href="javascript:void(0)" data-type="textarea" pk='+i+' class="'+f+'">'+h.amount+"</a>";d+='<tr class="item-detail"><td>'+j+'</td><td style="text-align: right;width: 200px">'+k+"</td></tr>"}d+="</tbody></table>",$($("[data-index="+a+"]").next()).children().html(d),$("."+e).editable(),$("."+f).editable(),$("."+e).on("save",function(a,b){$("#btn-save").prop("disabled",!1)}),$("."+f).on("save",function(a,b){$("#btn-save").prop("disabled",!1);var c=0;$("."+f).each(function(d,e){if(e!==a.target){var f=$(e).html();""!==f&&$.isNumeric(f)&&(c+=parseFloat(f))}else c+=parseFloat(b.newValue)}),c*=1+projectMargin,"None"!==projectAdminFee&&(c+=projectAdminFee),$(a.target).closest(".detail-view").prev().children(".subtotal").html("<b>"+accounting.formatMoney(c)+"</b>")})}),'<strong><i class="fa fa-spinner fa-spin"></i> Loading...</strong>'}$.ajax({url:getProjectVariationsUrl,type:"GET",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(a){"use strict";$("#table").bootstrapTable({columns:[{checkbox:!0},{field:"virtual_id",title:"#",halign:"center",sortable:!0},{field:"description",title:"Description",editable:{type:"textarea"},halign:"center",width:"600px"},{field:"date",title:"Date",formatter:"timeFormatter",halign:"center",width:"300px"},{field:"subcontractor",title:"Subcontractor",editable:{type:"text",validate:validate_required},halign:"center",sortable:!0},{field:"amount",title:"Subtotal ($)",halign:"center",sortable:!0,formatter:"moneyFormatter",class:"subtotal"},{field:"invoice_no",title:"Invoice #",editable:!0,halign:"center"},{field:"note",title:"Note",editable:{type:"textarea"},halign:"center"},{field:"pending",title:"Pending",formatter:"pendingFormatter",halign:"center",valign:"center",sortable:!0,class:"pending"},{field:"approved",title:"Approved",formatter:"approvedFormatter",halign:"center",valign:"center",sortable:!0,class:"approved"},{field:"declined",title:"Declined",formatter:"declinedFormatter",halign:"center",valign:"center",sortable:!0,class:"declined"},{field:"completed",title:"Completed",formatter:"completeFormatter",halign:"center",valign:"center",sortable:!0,class:"completed"}],data:a.variations,rowStyle:"rowStyle",toolbar:"#toolbar",detailView:!0,detailFormatter:"detailFormatter"})}).always(function(){"use strict";$("body").addClass("loaded")}),$("#btn-delete").on("click",function(){"use strict";swal({title:"Are you sure to delete selected rows?",text:"You cannot recover them later!",type:"warning",showCancelButton:!0,confirmButtonColor:"teal",confirmButtonText:"Yes, save them!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1,customClass:"deleteRowsConfirmation"},function(a){if(!a)return void swal("Cancelled","Your project is safe :)","error");var b=$(".deleteRowsConfirmation").find(".confirm"),c=b.html();b.html('<i class="fa fa-spinner fa-spin"></i> '+c),b.off("click");for(var d=$table.bootstrapTable("getSelections"),e=new Array(d.length),f=0;f<e.length;f+=1)e[f]=null;!function a(b){return b>=d.length?!0:void $.ajax({url:"/api/v1.0/variations/"+d[b].vid,type:"DELETE",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){e[b]=!0,a(b+1)}).fail(function(){e[b]=!1})}(0),function a(){e.some(isFalse)||(e.some(isNull)?setTimeout(a,100):e.every(isTrue)&&swal({title:"Nice!",text:"Delete variations",type:"success"},function(){location.reload()}))}()})}),$("#btn-save").on("click",function(){"use strict";swal({title:"Are you sure to save all the changes?",type:"info",showCancelButton:!0,confirmButtonColor:"teal",confirmButtonText:"Yes, save them!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1,customClass:"saveVariationsConfirmation"},function(a){if(!a)return void swal("Cancelled","Your saves are unsaved","error");var b=$(".saveVariationsConfirmation").find(".confirm"),c=b.html();b.html('<i class="fa fa-spinner fa-spin"></i> '+c),b.off("click");for(var d=$table.bootstrapTable("getData"),e=new Array(d.length),f=0;f<e.length;f+=1)e[f]=null;!function a(b){if(!(b>=d.length)){var c=d[b],f=c.vid,g="[data-index="+b+"]",h=$(g);c.pending=h.find(".pending").children().children().is(":checked"),c.approved=h.find(".approved").children().children().is(":checked"),c.declined=h.find(".declined").children().children().is(":checked"),c.completed=h.find(".completed").children().children().is(":checked"),c.amount=accounting.parse(h.find(".subtotal").html()),$.ajax({url:"/api/v1.0/variations/"+f,type:"PUT",data:JSON.stringify(c),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){e[b]=!0,a(b+1)}).fail(function(){e[b]=!1})}}(0);for(var g=$(".item-detail"),h=new Array(g.length),i=0;i<h.length;i+=1)h[i]=null;!function a(b){if(!(b>=g.length)){var c=$(g[b]).find("a"),d=$(c[0]),e=$(c[1]),f=d.attr("pk"),i=d.html(),j=parseFloat(e.html());$.ajax({url:"/api/v1.0/items/"+f,type:"PUT",data:JSON.stringify({amount:j,description:i}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){h[b]=!0,a(b+1)}).fail(function(){h[b]=!1})}}(0),function a(){e.some(isFalse)||h.some(isFalse)||(e.some(isNull)||h.some(isNull)?setTimeout(a,100):(e.every(isTrue)||h.every(isTrue))&&swal({title:"Nice!",text:"You saved all changes.",type:"success"},function(){location.reload()}))}()})});
//# sourceMappingURL=variation.min.js.map