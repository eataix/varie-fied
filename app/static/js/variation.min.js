function pendingClick(e){"use strict";var t=$(e).parents("tr");t.attr("class","info"),t.find(".checkbox-approved").prop("checked",!1),t.find(".checkbox-declined").prop("checked",!1),$("#btn-save").prop("disabled",!1)}function pendingFormatter(e,t,n){"use strict";var a;return a=e?'<input class="checkbox checkbox-pending" type="checkbox" checked="" onclick="pendingClick(this);">':'<input class="checkbox checkbox-pending" type="checkbox" onclick="pendingClick(this);">',"<label>"+a+"</label>"}function approvedClick(e){"use strict";var t=$(e).parents("tr");t.attr("class","success"),t.find(".checkbox-pending").prop("checked",!1),t.find(".checkbox-declined").prop("checked",!1),$("#btn-save").prop("disabled",!1)}function approvedFormatter(e,t,n){"use strict";var a;return a=e?'<input class="checkbox checkbox-approved" type="checkbox" checked="" onclick="approvedClick(this);">':'<input class="checkbox checkbox-approved" type="checkbox" onclick="approvedClick(this);">',"<label>"+a+"</label>"}function declinedClick(e){"use strict";var t=$(e).parents("tr");t.attr("class","danger"),t.find(".checkbox-pending").prop("checked",!1),t.find(".checkbox-approved").prop("checked",!1),$("#btn-save").prop("disabled",!1)}function declinedFormatter(e,t,n){"use strict";var a;return a=e?'<input class="checkbox checkbox-declined" type="checkbox" checked="" onclick="declinedClick(this);">':'<input class="checkbox checkbox-declined" type="checkbox" onclick="declinedClick(this);">',"<label>"+a+"</label>"}function completeClick(){"use strict";$("#btn-save").prop("disabled",!1)}function completeFormatter(e,t,n){"use strict";var a;return a=e?'<input class="checkbox checkbox-complete" type="checkbox" checked="" onclick="completeClick();">':'<input class="checkbox checkbox-complete" type="checkbox" onclick="completeClick();">',"<label>"+a+"</label>"}function rowStyle(e,t){"use strict";return e.pending?{classes:"info"}:e.approved?{classes:"success"}:e.declined?{classes:"danger"}:{classes:"active"}}function timeFormatter(e,t,n){"use strict";return"<p>"+moment(e).toDate()+"</p>"}function moneyFormatter(e,t,n){"use strict";return accounting.formatMoney(e)}function validate_required(e){"use strict";return null===e||""===e?"Cannot be empty!":void 0}function detailFormatter(e,t){"use strict";var n="/api/v1.0/variations/"+t.vid+"/items/";return setTimeout(function(){$.ajax({url:n,type:"GET",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(t){for(var n=t.items,a='<table class="table table-hover"><thead><tr><th style="text-align: center">Name</th><th style="text-align: center">Amount</th></tr></thead><tbody>',c="new-editable-description-"+e,i="new-editable-amount-"+e,o=0;o<n.length;o+=1){var r=n[o],l=r.id,s='<a href="javascript:void(0)" data-type="textarea" pk='+l+' class="'+c+'">'+r.description+"</a>",d='<a href="javascript:void(0)" data-type="textarea" pk='+l+' class="'+i+'">'+r.amount+"</a>";a+='<tr class="item-detail"><td>'+s+'</td><td style="text-align: right;width: 200px">'+d+"</td></tr>"}a+="</tbody></table>",$($("[data-index="+e+"]").next()).children().html(a),$("."+c).editable(),$("."+i).editable(),$("."+c).on("save",function(e,t){$("#btn-save").prop("disabled",!1)}),$("."+i).on("save",function(e,t){$("#btn-save").prop("disabled",!1);var n=0;$("."+i).each(function(a,c){if(c!==e.target){var i=$(c).html();""!==i&&isNumeric(i)&&(n+=parseFloat(i))}else n+=parseFloat(t.newValue)}),n*=1+projectMargin,"None"!==projectAdminFee&&(n+=projectAdminFee),$(e.target).closest(".detail-view").prev().children(".subtotal").html("<b>"+accounting.formatMoney(n)+"</b>")})})},0),'<strong><i class="fa fa-spinner fa-spin"></i> Loading...</strong>'}var metaData=$("#project-data").data(),deleteProjectUrl=metaData.deleteProjectUrl,editProjectUrl=metaData.editProjectUrl,getProjectVariationsUrl=metaData.getProjectVariationsUrl,projectActive=metaData.projectActive,projectAdminFee=metaData.projectAdminFee,projectId=metaData.projectId,projectMargin=metaData.projectMargin,projectName=metaData.projectName;$.ajax({url:getProjectVariationsUrl,type:"GET",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(e){"use strict";$("#table").bootstrapTable({columns:[{checkbox:!0},{field:"virtual_id",title:"#",halign:"center",sortable:!0},{field:"description",title:"Description",editable:{type:"textarea"},halign:"center",width:"600px"},{field:"date",title:"Date",formatter:"timeFormatter",halign:"center",width:"300px"},{field:"subcontractor",title:"Subcontractor",editable:{type:"text",validate:validate_required},halign:"center",sortable:!0},{field:"amount",title:"Subtotal ($)",halign:"center",sortable:!0,formatter:"moneyFormatter",class:"subtotal"},{field:"invoice_no",title:"Invoice #",editable:!0,halign:"center"},{field:"note",title:"Note",editable:{type:"textarea"},halign:"center"},{field:"pending",title:"Pending",formatter:"pendingFormatter",halign:"center",valign:"center",sortable:!0,class:"pending"},{field:"approved",title:"Approved",formatter:"approvedFormatter",halign:"center",valign:"center",sortable:!0,class:"approved"},{field:"declined",title:"Declined",formatter:"declinedFormatter",halign:"center",valign:"center",sortable:!0,class:"declined"},{field:"completed",title:"Completed",formatter:"completeFormatter",halign:"center",valign:"center",sortable:!0,class:"completed"}],data:e.variations,rowStyle:"rowStyle",toolbar:"#toolbar",detailView:!0,detailFormatter:"detailFormatter"})}).always(function(){"use strict";$("body").addClass("loaded")}),$("#btn-delete").on("click",function(){"use strict";swal({title:"Are you sure to delete selected rows?",text:"You cannot recover them later!",type:"warning",showCancelButton:!0,confirmButtonColor:"teal",confirmButtonText:"Yes, save them!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1,customClass:"deleteRowsConfirmation"},function(e){if(!e)return void swal("Cancelled","Your project is safe :)","error");var t=$(".deleteRowsConfirmation").find(".confirm"),n=t.html();t.html('<i class="fa fa-spinner fa-spin"></i> '+n),t.off("click");for(var a=$table.bootstrapTable("getSelections"),c=new Array(a.length),i=0;i<c.length;i+=1)c[i]=null;!function e(t){return t>=a.length?!0:void $.ajax({url:"/api/v1.0/variations/"+a[t].vid,type:"DELETE",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){c[t]=!0,e(t+1)}).fail(function(){c[t]=!1})}(0),function e(){_.some(c,function(e){return e===!1})||(_.some(c,function(e){return null===e})?setTimeout(e,100):_.every(c,function(e){return e===!0})&&swal({title:"Nice!",text:"Delete variations",type:"success"},function(){location.reload()}))}()})}),$("#btn-save").on("click",function(){"use strict";swal({title:"Are you sure to save all the changes?",type:"info",showCancelButton:!0,confirmButtonColor:"teal",confirmButtonText:"Yes, save them!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1,customClass:"saveVariationsConfirmation"},function(e){if(!e)return void swal("Cancelled","Your saves are unsaved","error");var t=$(".saveVariationsConfirmation").find(".confirm"),n=t.html();t.html('<i class="fa fa-spinner fa-spin"></i> '+n),t.off("click");for(var a=$table.bootstrapTable("getData"),c=new Array(a.length),i=0;i<c.length;i+=1)c[i]=null;!function e(t){if(!(t>=a.length)){var n=a[t],i=n.vid,o="[data-index="+t+"]",r=$(o);n.pending=r.find(".pending").children().children().is(":checked"),n.approved=r.find(".approved").children().children().is(":checked"),n.declined=r.find(".declined").children().children().is(":checked"),n.completed=r.find(".completed").children().children().is(":checked"),n.amount=accounting.parse(r.find(".subtotal").html()),$.ajax({url:"/api/v1.0/variations/"+i,type:"PUT",data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){c[t]=!0}).fail(function(){c[t]=!1}),e(t+1)}}(0);for(var o=new Array(a.length),r=0;r<o.length;r+=1)o[r]=null;$(".item-detail").each(function(e,t){var n=$(t).find("a"),a=$(n[0]),c=$(n[1]),r=a.attr("pk"),l=a.html(),s=parseFloat(c.html());$.ajax({url:"/api/v1.0/items/"+r,type:"PUT",data:JSON.stringify({amount:s,description:l}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){o[e]=!0}).fail(function(){o[i]=!1})}),function e(){_.some(c,function(e){return e===!1})||_.some(o,function(e){return e===!1})||(_.some(c,function(e){return null===e})||_.some(o,function(e){return null===e})?setTimeout(e,100):_.every(c,function(e){return e===!0})&&_.every(o,function(e){return e===!0})&&swal({title:"Nice!",text:"You saved all changes.",type:"success"},function(){location.reload()}))}()})});
//# sourceMappingURL=variation.min.map